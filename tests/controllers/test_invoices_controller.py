# -*- coding: utf-8 -*-

"""
maxioadvancedbillingformerlychargifyapi

This file was automatically generated by APIMATIC v3.0 (
 https://www.apimatic.io ).
"""

import json
import dateutil.parser

from tests.controllers.controller_test_base import ControllerTestBase
from apimatic_core.utilities.comparison_helper import ComparisonHelper
from maxioadvancedbillingformerlychargifyapi.api_helper import APIHelper
from maxioadvancedbillingformerlychargifyapi.models.create_multi_invoice_payment_request import CreateMultiInvoicePaymentRequest


class InvoicesControllerTests(ControllerTestBase):

    @classmethod
    def setUpClass(cls):
        super(InvoicesControllerTests, cls).setUpClass()
        cls.controller = cls.client.invoices
        cls.response_catcher = cls.controller.http_call_back

    # By default, invoices returned on the index will only include totals, not detailed breakdowns for `line_items`, `discounts`, `taxes`, `credits`, `payments`, `custom_fields`, or `refunds`. To include breakdowns, pass the specific field as a key in the query with a value set to `true`.
    def test_list_invoices(self):
        # Parameters for the API call
        start_date = None
        end_date = None
        status = None
        subscription_id = None
        subscription_group_uid = None
        page = 1
        per_page = 20
        direction = 'desc'
        line_items = False
        discounts = False
        taxes = False
        credits = False
        payments = False
        custom_fields = False
        refunds = False
        date_field = 'due_date'
        start_datetime = None
        end_datetime = None
        customer_ids = APIHelper.json_deserialize('[1,2,3]')
        number = APIHelper.json_deserialize('["1234","1235"]')
        product_ids = APIHelper.json_deserialize('[23,34]')
        sort = 'number'

        # Perform the API call through the SDK function
        result = self.controller.list_invoices(start_date, end_date, status, subscription_id, subscription_group_uid, page, per_page, direction, line_items, discounts, taxes, credits, payments, custom_fields, refunds, date_field, start_datetime, end_datetime, customer_ids, number, product_ids, sort)

        # Test response code
        assert self.response_catcher.response.status_code == 200

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"invoices":[{"uid":"inv_8htcd29wcq3q6","site_id":51288,"customer_'
            'id":20153415,"subscription_id":23277588,"number":"125","sequence_n'
            'umber":125,"issue_date":"2018-09-20","due_date":"2018-09-20","paid'
            '_date":"2018-09-20","status":"paid","collection_method":"automatic'
            '","payment_instructions":"Make checks payable to Acme, Inc.","curr'
            'ency":"USD","consolidation_level":"parent","parent_invoice_uid":nu'
            'll,"parent_invoice_number":null,"group_primary_subscription_id":23'
            '277588,"product_name":"Trial and setup fee","product_family_name":'
            '"Billing Plans","seller":{"name":"General Goods","address":{"stree'
            't":"123 General Goods Way","line2":"Apt. 10","city":"Boston","stat'
            'e":"MA","zip":"02120","country":"US"},"phone":"555-555-1212"},"cus'
            'tomer":{"chargify_id":20153415,"first_name":"Meg","last_name":"Exa'
            'mple","organization":"","email":"meg@example.com"},"memo":"Please '
            'pay within 15 days.","billing_address":{"street":"123 I Love Cats '
            'Way","line2":"","city":"Boston","state":"MA","zip":"90210","countr'
            'y":"US"},"shipping_address":{"street":"123 I Love Cats Way","line2'
            '":"","city":"Boston","state":"MA","zip":"90210","country":"US"},"s'
            'ubtotal_amount":"100.0","discount_amount":"0.0","tax_amount":"0.0"'
            ',"total_amount":"100.0","credit_amount":"0.0","paid_amount":"100.0'
            '","refund_amount":"0.0","due_amount":"0.0"},{"uid":"inv_8hr3546xp4'
            'h8n","site_id":51288,"customer_id":21687686,"subscription_id":2200'
            '7644,"number":"124","sequence_number":124,"issue_date":"2018-09-18'
            '","due_date":"2018-09-18","paid_date":null,"status":"open","collec'
            'tion_method":"remittance","payment_instructions":"Make checks paya'
            'ble to Acme, Inc.","currency":"USD","consolidation_level":"none","'
            'parent_invoice_uid":null,"parent_invoice_number":null,"group_prima'
            'ry_subscription_id":null,"product_name":"Trial and setup fee","pro'
            'duct_family_name":"Billing Plans","seller":{"name":"General Goods"'
            ',"address":{"street":"123 General Goods Way","line2":"Apt. 10","ci'
            'ty":"Boston","state":"MA","zip":"02120","country":"US"},"phone":"5'
            '55-555-1212"},"customer":{"chargify_id":21687686,"first_name":"Cha'
            'rlene","last_name":"Tester","organization":"","email":"food@exampl'
            'e.com"},"memo":"Please pay within 15 days.","billing_address":{"st'
            'reet":"","line2":"","city":"","state":"","zip":"","country":""},"s'
            'hipping_address":{"street":"","line2":"","city":"","state":"","zip'
            '":"","country":""},"subtotal_amount":"100.0","discount_amount":"0.'
            '0","tax_amount":"0.0","total_amount":"100.0","credit_amount":"0.0"'
            ',"paid_amount":"0.0","refund_amount":"0.0","due_amount":"100.0"},{'
            '"uid":"inv_8hr3546wdwxkr","site_id":51288,"customer_id":21687670,"'
            'subscription_id":22007627,"number":"123","sequence_number":123,"is'
            'sue_date":"2018-09-18","due_date":"2018-09-18","paid_date":"2018-0'
            '9-18","status":"paid","collection_method":"automatic","payment_ins'
            'tructions":"Make checks payable to Acme, Inc.","currency":"USD","c'
            'onsolidation_level":"none","parent_invoice_uid":null,"parent_invoi'
            'ce_number":null,"group_primary_subscription_id":null,"product_name'
            '":"Trial End - Free","product_family_name":"Billing Plans","seller'
            '":{"name":"General Goods","address":{"street":"123 General Goods W'
            'ay","line2":"Apt. 10","city":"Boston","state":"MA","zip":"02120","'
            'country":"US"},"phone":"555-555-1212"},"customer":{"chargify_id":2'
            '1687670,"first_name":"Hello","last_name":"World","organization":"1'
            '23","email":"example@example.com"},"memo":"Please pay within 15 da'
            'ys.","billing_address":{"street":"123 Anywhere Street","line2":"",'
            '"city":"Boston","state":"MA","zip":"02120","country":"US"},"shippi'
            'ng_address":{"street":"","line2":"","city":"Boston","state":"AL","'
            'zip":"02120","country":"US"},"subtotal_amount":"0.0","discount_amo'
            'unt":"0.0","tax_amount":"0.0","total_amount":"0.0","credit_amount"'
            ':"0.0","paid_amount":"0.0","refund_amount":"0.0","due_amount":"0.0'
            '"},{"uid":"inv_8hjtk8bz56bbp","site_id":51288,"customer_id":201377'
            '57,"subscription_id":20541100,"number":"122","sequence_number":122'
            ',"issue_date":"2018-09-10","due_date":"2018-09-10","paid_date":"20'
            '18-09-10","status":"paid","collection_method":"automatic","payment'
            '_instructions":"Make checks payable to Acme, Inc.","currency":"USD'
            '","consolidation_level":"none","parent_invoice_uid":null,"parent_i'
            'nvoice_number":null,"group_primary_subscription_id":null,"product_'
            'name":"$0 Product","product_family_name":"Billing Plans","seller":'
            '{"name":"General Goods","address":{"street":"123 General Goods Way'
            '","line2":"Apt. 10","city":"Boston","state":"MA","zip":"02120","co'
            'untry":"US"},"phone":"555-555-1212"},"customer":{"chargify_id":201'
            '37757,"first_name":"Sasha","last_name":"Example","organization":""'
            ',"email":"example@example.com"},"memo":"Please pay within 15 days.'
            '","billing_address":{"street":"123 I Love Cats Way","line2":"","ci'
            'ty":"Catville","state":"MA","zip":"90210","country":"US"},"shippin'
            'g_address":{"street":"123 I Love Cats Way","line2":"","city":"Catv'
            'ille","state":"AL","zip":"90210","country":"US"},"subtotal_amount"'
            ':"0.0","discount_amount":"0.0","tax_amount":"0.0","total_amount":"'
            '0.0","credit_amount":"0.0","paid_amount":"0.0","refund_amount":"0.'
            '0","due_amount":"0.0"}],"public_url":"https://www.chargifypay.com/'
            'invoice/inv_8jzrw74xq8kxr?token=fb6kpjz5rcr2vttyjs4rcv6y"}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

    # This endpoint returns a list of invoice events. Each event contains event "data" (such as an applied payment) as well as a snapshot of the `invoice` at the time of event completion.
    #
    #Exposed event types are:
    #
    #+ issue_invoice
    #+ apply_credit_note
    #+ apply_payment
    #+ refund_invoice
    #+ void_invoice
    #+ void_remainder
    #+ backport_invoice
    #+ change_invoice_status
    #+ change_invoice_collection_method
    #+ remove_payment
    #
    #Invoice events are returned in ascending order.
    #
    #If both a `since_date` and `since_id` are provided in request parameters, the `since_date` will be used.
    #
    #Note - invoice events that occurred prior to 09/05/2018 __will not__ contain an `invoice` snapshot.
    def test_list_invoice_events(self):
        # Parameters for the API call
        since_date = None
        since_id = None
        page = 1
        per_page = 100
        invoice_uid = None
        with_change_invoice_status = None
        event_types = None

        # Perform the API call through the SDK function
        result = self.controller.list_invoice_events(since_date, since_id, page, per_page, invoice_uid, with_change_invoice_status, event_types)

        # Test response code
        assert self.response_catcher.response.status_code == 200

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"events":[{"id":83,"event_type":"apply_payment","event_data":{"me'
            'mo":"Non-Resumable Canceled On Purpose - Standard Plan: Renewal pa'
            'yment","original_amount":"168.61","applied_amount":"168.61","trans'
            'action_time":"2018-08-01T16:00:00Z","payment_method":{"card_brand"'
            ':"visa","card_expiration":"12/2022","last_four":null,"masked_card_'
            'number":"XXXX-XXXX-XXXX-1111","type":"credit_card"},"transaction_i'
            'd":126,"consolidation_level":"none","parent_invoice_number":null},'
            '"timestamp":"2018-08-01T16:00:00Z","invoice":{"id":614942008934401'
            '500,"uid":"inv_8gk5bwkct3gqt","site_id":20,"customer_id":6,"subscr'
            'iption_id":10,"number":"25","sequence_number":25,"transaction_time'
            '":"2018-08-01T16:00:00Z","created_at":"2018-08-01T16:00:00Z","upda'
            'ted_at":"2018-08-01T16:00:00Z","issue_date":"2018-08-01","due_date'
            '":"2018-08-01","paid_date":"2018-08-01","status":"paid","role":"re'
            'newal","collection_method":"automatic","payment_instructions":"Ple'
            'ase make checks payable to \"Acme, Inc.\"","currency":"USD","conso'
            'lidation_level":"none","parent_invoice_id":null,"subscription_grou'
            'p_id":null,"parent_invoice_number":null,"product_name":"Standard P'
            'lan","product_family_name":"Cloud Compute Servers","seller":{"name'
            '":"Acme, Inc.","address":{"street":null,"line2":null,"city":null,"'
            'state":null,"zip":null,"country":null},"phone":"555-555-1234 x137"'
            ',"logo_url":null},"customer":{"chargify_id":6,"first_name":"Non-Re'
            'sumable","last_name":"Canceled On Purpose","organization":null,"em'
            'ail":"evan4@example.com"},"payer":{"chargify_id":6,"first_name":"N'
            'on-Resumable","last_name":"Canceled On Purpose","organization":nul'
            'l,"email":"evan4@example.com"},"recipient_emails":[],"terms":"due_'
            'on_receipt","memo":"Thanks for your business! If you have any ques'
            'tions, please contact your account manager.","billing_address":{"s'
            'treet":"200 Billing Rd.","line2":"Suite 100","city":"Needham","sta'
            'te":"MA","zip":"02494","country":"US"},"shipping_address":{"street'
            '":"100 Shipping St.","line2":"Apt 200","city":"Pleasantville","sta'
            'te":"NC","zip":"12345","country":"US"},"line_items":[{"uid":"li_8g'
            'k5bwkct3gqk","title":"Standard Plan","description":"08/01/2018 - 0'
            '9/01/2018","quantity":"1.0","unit_price":"99.0","subtotal_amount":'
            '"99.0","discount_amount":"9.9","tax_amount":"6.01425","total_amoun'
            't":"95.11425","tiered_unit_price":false,"period_range_start":"2018'
            '-08-01","period_range_end":"2018-09-01","transaction_id":120,"prod'
            'uct_id":84,"product_version":1,"component_id":null,"price_point_id'
            '":null,"hide":false,"component_cost_data":null},{"uid":"li_8gk5bwk'
            'ct3gqm","title":"Small Instance (Hourly)","description":"07/22/201'
            '8 - 08/01/2018","quantity":"162.0","unit_price":"0.09567901","subt'
            'otal_amount":"15.5","discount_amount":"1.55","tax_amount":"0.94162'
            '5","total_amount":"14.891625","tiered_unit_price":true,"period_ran'
            'ge_start":"2018-07-22","period_range_end":"2018-08-01","transactio'
            'n_id":121,"product_id":84,"product_version":1,"component_id":76,"p'
            'rice_point_id":null,"hide":false,"component_cost_data":{"rates":[{'
            '"component_code_id":null,"price_point_id":160,"product_id":84,"qua'
            'ntity":"162.0","amount":"15.5","pricing_scheme":"tiered","tiers":['
            '{"starting_quantity":1,"ending_quantity":100,"quantity":"100.0","u'
            'nit_price":"0.0","amount":"0.0"},{"starting_quantity":101,"ending_'
            'quantity":null,"quantity":"62.0","unit_price":"0.25","amount":"15.'
            '5"}]}]}},{"uid":"li_8gk5bwkct3gqn","title":"Large Instance (Hourly'
            ')","description":"07/22/2018 - 08/01/2018","quantity":"194.0","uni'
            't_price":"0.24226804","subtotal_amount":"47.0","discount_amount":"'
            '4.7","tax_amount":"2.85525","total_amount":"45.15525","tiered_unit'
            '_price":true,"period_range_start":"2018-07-22","period_range_end":'
            '"2018-08-01","transaction_id":122,"product_id":84,"product_version'
            '":1,"component_id":77,"price_point_id":null,"hide":false,"componen'
            't_cost_data":{"rates":[{"component_code_id":null,"price_point_id":'
            '161,"product_id":84,"quantity":"194.0","amount":"47.0","pricing_sc'
            'heme":"tiered","tiers":[{"starting_quantity":1,"ending_quantity":1'
            '00,"quantity":"100.0","unit_price":"0.0","amount":"0.0"},{"startin'
            'g_quantity":101,"ending_quantity":null,"quantity":"94.0","unit_pri'
            'ce":"0.5","amount":"47.0"}]}]}},{"uid":"li_8gk5bwkct3gqp","title":'
            '"IP Addresses","description":"08/01/2018 - 09/01/2018","quantity":'
            '"7.0","unit_price":"2.0","subtotal_amount":"14.0","discount_amount'
            '":"1.4","tax_amount":"0.8505","total_amount":"13.4505","tiered_uni'
            't_price":false,"period_range_start":"2018-08-01","period_range_end'
            '":"2018-09-01","transaction_id":123,"product_id":84,"product_versi'
            'on":1,"component_id":79,"price_point_id":163,"hide":false,"compone'
            'nt_cost_data":{"rates":[{"component_code_id":null,"price_point_id"'
            ':163,"product_id":84,"quantity":"7.0","amount":"14.0","pricing_sch'
            'eme":"per_unit","tiers":[{"starting_quantity":1,"ending_quantity":'
            'null,"quantity":"7.0","unit_price":"2.0","amount":"14.0"}]}]}}],"s'
            'ubtotal_amount":"175.5","discount_amount":"17.55","discounts":[{"u'
            'id":"dli_8gk5bwkct3gqq","title":"Multi-service discount (10%)","de'
            'scription":null,"code":"MULTI3","source_type":"Coupon","source_id"'
            ':40,"discount_type":"percentage","percentage":"10.0","eligible_amo'
            'unt":"175.5","discount_amount":"17.55","transaction_id":124,"line_'
            'item_breakouts":[{"uid":"li_8gk5bwkct3gqk","eligible_amount":"99.0'
            '","discount_amount":"9.9"},{"uid":"li_8gk5bwkct3gqm","eligible_amo'
            'unt":"15.5","discount_amount":"1.55"},{"uid":"li_8gk5bwkct3gqn","e'
            'ligible_amount":"47.0","discount_amount":"4.7"},{"uid":"li_8gk5bwk'
            'ct3gqp","eligible_amount":"14.0","discount_amount":"1.4"}]}],"tax_'
            'amount":"10.66","taxes":[{"uid":"tli_8gk5bwkct3gqr","title":"NC Sa'
            'les Tax","description":null,"source_type":"Tax","source_id":1,"per'
            'centage":"6.75","taxable_amount":"157.95","tax_amount":"10.66","tr'
            'ansaction_id":125,"line_item_breakouts":[{"uid":"li_8gk5bwkct3gqk"'
            ',"taxable_amount":"89.1","tax_amount":"6.01425"},{"uid":"li_8gk5bw'
            'kct3gqm","taxable_amount":"13.95","tax_amount":"0.941625"},{"uid":'
            '"li_8gk5bwkct3gqn","taxable_amount":"42.3","tax_amount":"2.85525"}'
            ',{"uid":"li_8gk5bwkct3gqp","taxable_amount":"12.6","tax_amount":"0'
            '.8505"}],"tax_component_breakouts":[{"tax_rule_id":1,"percentage":'
            '"6.75","country_code":"US","subdivision_code":"NC"}]}],"credit_amo'
            'unt":"0.0","refund_amount":"0.0","total_amount":"168.61","paid_amo'
            'unt":"168.61","due_amount":"0.0","credits":[],"refunds":[],"paymen'
            'ts":[{"memo":"Non-Resumable Canceled On Purpose - Standard Plan: R'
            'enewal payment","original_amount":"168.61","applied_amount":"168.6'
            '1","transaction_time":"2018-08-01T16:00:00Z","payment_method":{"ca'
            'rd_brand":"visa","card_expiration":"12/2022","last_four":null,"mas'
            'ked_card_number":"XXXX-XXXX-XXXX-1111","type":"credit_card"},"tran'
            'saction_id":126,"prepayment":false}],"custom_fields":[],"display_s'
            'ettings":{"hide_zero_subtotal_lines":false,"include_discounts_on_l'
            'ines":false}}}],"page":48,"per_page":1,"total_pages":102}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

    # This API call should be used when you want to record an external payment against multiple invoices.
    #
    # In order apply a payment to multiple invoices, at minimum, specify the `amount` and `applications` (i.e., `invoice_uid` and `amount`) details.
    #
    #```
    #{
    #  "payment": {
    #    "memo": "to pay the bills",
    #    "details": "check number 8675309",
    #    "method": "check",
    #    "amount": "250.00",
    #    "applications": [
    #      {
    #        "invoice_uid": "inv_8gk5bwkct3gqt",
    #        "amount": "100.00"
    #      },
    #      {
    #        "invoice_uid": "inv_7bc6bwkct3lyt",
    #        "amount": "150.00"
    #      }
    #    ]
    #  }
    #}
    #```
    #
    #Note that the invoice payment amounts must be greater than 0. Total amount must be greater or equal to invoices payment amount sum.
    def test_record_external_payment_for_invoices(self):
        # Parameters for the API call
        body = APIHelper.json_deserialize('{"payment":{"memo":"to pay the bills","details":"check number 8675'
            '309","method":"check","amount":"100.00","applications":[{"invoice_'
            'uid":"inv_8gk5bwkct3gqt","amount":"50.00"},{"invoice_uid":"inv_7bc'
            '6bwkct3lyt","amount":"50.00"}]}}', CreateMultiInvoicePaymentRequest.from_dictionary)

        # Perform the API call through the SDK function
        result = self.controller.record_external_payment_for_invoices(body)

        # Test response code
        assert self.response_catcher.response.status_code == 200

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"payment":{"transaction_id":1,"total_amount":"100.00","currency_c'
            'ode":"USD","applications":[{"invoice_uid":"inv_8gk5bwkct3gqt","app'
            'lication_uid":"pmt_1tr0hgsct3ybx","applied_amount":"50.00"},{"invo'
            'ice_uid":"inv_7bc6bwkct3lyt","application_uid":"pmt_2","applied_am'
            'ount":"50.00"}]}}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

    # Credit Notes are like inverse invoices. They reduce the amount a customer owes.
    #
    #By default, the credit notes returned by this endpoint will exclude the arrays of `line_items`, `discounts`, `taxes`, `applications`, or `refunds`. To include these arrays, pass the specific field as a key in the query with a value set to `true`.
    def test_list_credit_notes(self):
        # Parameters for the API call
        subscription_id = None
        page = 1
        per_page = 20
        line_items = False
        discounts = False
        taxes = False
        refunds = False
        applications = False

        # Perform the API call through the SDK function
        result = self.controller.list_credit_notes(subscription_id, page, per_page, line_items, discounts, taxes, refunds, applications)

        # Test response code
        assert self.response_catcher.response.status_code == 200

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"credit_notes":[{"uid":"cn_8m9vbd5kkv7kr","site_id":20,"customer_'
            'id":3,"subscription_id":2,"number":"77","sequence_number":78,"issu'
            'e_date":"2018-12-31","applied_date":"2018-12-31","status":"applied'
            '","currency":"USD","memo":"Refund for overpayment","seller":{"name'
            '":"Acme, Inc.","address":{"street":"122 E Houston St","line2":"Sui'
            'te 105","city":"San Antonio","state":"TX","zip":"78205","country":'
            '"US"},"phone":"555-555-1234 x137"},"customer":{"chargify_id":3,"fi'
            'rst_name":"Marty","last_name":"McFly","organization":"Time Travell'
            'ers, Inc.","email":"timetraveller1985@example.com","reference":nul'
            'l},"billing_address":{"street":"200 Billing Rd.","line2":"Suite 10'
            '0","city":"Needham","state":"MA","zip":"02494","country":"US"},"sh'
            'ipping_address":{"street":"100 Shipping St.","line2":"Apt 200","ci'
            'ty":"Pleasantville","state":"NC","zip":"12345","country":"US"},"su'
            'btotal_amount":"208.69341779","discount_amount":"20.87125167","tax'
            '_amount":"12.67783387","total_amount":"200.5","applied_amount":"20'
            '0.5","remaining_amount":"0.0","line_items":[{"uid":"cnli_8k5jvdzct'
            '4h9x","title":"IP Addresses: 5 to 10 addresses","description":"38.'
            '2% credit","quantity":"0.9855","unit_price":"2.0","subtotal_amount'
            '":"1.971004","discount_amount":"0.19862831","tax_amount":"0.119635'
            '36","total_amount":"1.89201105","tiered_unit_price":false,"period_'
            'range_start":"2018-11-30","period_range_end":"2018-11-30","product'
            '_id":85,"product_version":1,"component_id":81,"price_point_id":165'
            '},{"uid":"cnli_8kjttvjcjx8b4","title":"Professional Plan","descrip'
            'tion":"38.2% credit","quantity":"0.382","unit_price":"299.0","subt'
            'otal_amount":"114.21127834","discount_amount":"11.42112783","tax_a'
            'mount":"6.93833516","total_amount":"109.72848567","tiered_unit_pri'
            'ce":false,"period_range_start":"2018-12-30","period_range_end":"20'
            '18-12-30","product_id":85,"product_version":1,"component_id":null,'
            '"price_point_id":null},{"uid":"cnli_8kjttvjknzhx7","title":"Small '
            'Instance (Hourly)","description":"38.2% credit","quantity":"74.867'
            '6","unit_price":"0.12244898","subtotal_amount":"9.16746047","disco'
            'unt_amount":"0.91674605","tax_amount":"0.55692322","total_amount":'
            '"8.80763764","tiered_unit_price":true,"period_range_start":"2018-1'
            '1-30","period_range_end":"2018-11-30","product_id":85,"product_ver'
            'sion":1,"component_id":78,"price_point_id":null},{"uid":"cnli_8kjt'
            'tvjnmh25w","title":"Large Instance (Hourly)","description":"38.2% '
            'credit","quantity":"183.3492","unit_price":"0.39583333","subtotal_'
            'amount":"72.57572871","discount_amount":"7.25757287","tax_amount":'
            '"4.40897552","total_amount":"69.72713136","tiered_unit_price":true'
            ',"period_range_start":"2018-11-30","period_range_end":"2018-11-30"'
            ',"product_id":85,"product_version":1,"component_id":79,"price_poin'
            't_id":null},{"uid":"cnli_8kjttvjqn86kc","title":"Email Messages","'
            'description":"38.2% credit","quantity":"10076.9489","unit_price":"'
            '0.00031045","subtotal_amount":"3.12839588","discount_amount":"0.31'
            '322157","tax_amount":"0.19002427","total_amount":"3.00519858","tie'
            'red_unit_price":true,"period_range_start":"2018-11-30","period_ran'
            'ge_end":"2018-11-30","product_id":85,"product_version":1,"componen'
            't_id":80,"price_point_id":null},{"uid":"cnli_8kjttvjtxxbdd","title'
            '":"IP Addresses","description":"38.2% credit","quantity":"3.8198",'
            '"unit_price":"2.0","subtotal_amount":"7.63955039","discount_amount'
            '":"0.76395504","tax_amount":"0.46410269","total_amount":"7.3396980'
            '4","tiered_unit_price":false,"period_range_start":"2018-12-30","pe'
            'riod_range_end":"2018-12-30","product_id":85,"product_version":1,"'
            'component_id":81,"price_point_id":165}],"discounts":[{"uid":"cndli'
            '_8k5jvdzct4h9y","title":"Multi-service discount (10%)","code":"MUL'
            'TI3","source_type":"Coupon","source_id":40,"discount_type":"percen'
            'tage","percentage":"10.0","eligible_amount":"208.69341779","discou'
            'nt_amount":"20.87125167","line_item_breakouts":[{"uid":"cnli_8k5jv'
            'dzct4h9x","eligible_amount":"1.971004","discount_amount":"0.198628'
            '31"},{"uid":"cnli_8kjttvjcjx8b4","eligible_amount":"114.21127834",'
            '"discount_amount":"11.42112783"},{"uid":"cnli_8kjttvjknzhx7","elig'
            'ible_amount":"9.16746047","discount_amount":"0.91674605"},{"uid":"'
            'cnli_8kjttvjnmh25w","eligible_amount":"72.57572871","discount_amou'
            'nt":"7.25757287"},{"uid":"cnli_8kjttvjqn86kc","eligible_amount":"3'
            '.12839588","discount_amount":"0.31322157"},{"uid":"cnli_8kjttvjtxx'
            'bdd","eligible_amount":"7.63955039","discount_amount":"0.76395504"'
            '}]}],"taxes":[{"uid":"cntli_8k5jvdzct4h9z","title":"NC Sales Tax",'
            '"source_type":"Tax","source_id":1,"percentage":"6.75","taxable_amo'
            'unt":"187.82216613","tax_amount":"12.67783387","line_item_breakout'
            's":[{"uid":"cnli_8k5jvdzct4h9x","taxable_amount":"1.77237569","tax'
            '_amount":"0.11963536"},{"uid":"cnli_8kjttvjcjx8b4","taxable_amount'
            '":"102.7901505","tax_amount":"6.93833516"},{"uid":"cnli_8kjttvjknz'
            'hx7","taxable_amount":"8.25071442","tax_amount":"0.55692322"},{"ui'
            'd":"cnli_8kjttvjnmh25w","taxable_amount":"65.31815584","tax_amount'
            '":"4.40897552"},{"uid":"cnli_8kjttvjqn86kc","taxable_amount":"2.81'
            '517432","tax_amount":"0.19002427"},{"uid":"cnli_8kjttvjtxxbdd","ta'
            'xable_amount":"6.87559535","tax_amount":"0.46410269"}]}],"applicat'
            'ions":[{"uid":"cdt_8m9vbdbdwd28n","transaction_time":"2018-12-31T2'
            '1:19:28Z","invoice_uid":"inv_8k5jvdzct4hb2","memo":"Refund for ove'
            'rpayment","applied_amount":"200.5"}],"refunds":[{"transaction_id":'
            '329,"payment_id":39,"memo":"Refund for overpayment","original_amou'
            'nt":"524.9","applied_amount":"200.5"}]}]}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

